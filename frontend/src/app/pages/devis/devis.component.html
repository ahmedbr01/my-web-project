<div class="devis-container">
  <div class="devis-header">
    <h1><span class="icon">üìã</span> Demande de Devis</h1>
    <p class="subtitle">Remplissez ce formulaire pour obtenir un devis personnalis√© pour votre projet</p>
  </div>

  <!-- Messages d'erreur -->
  @if (errorMessage) {
    <div class="alert alert-error">
      <span class="alert-icon">‚ö†Ô∏è</span>
      <div class="alert-content">
        <strong>Erreur :</strong> {{ errorMessage }}
      </div>
    </div>
  }

  <!-- Message de succ√®s -->
  @if (showSuccess) {
    <div class="alert alert-success">
      <span class="alert-icon">‚úÖ</span>
      <div class="alert-content">
        <strong>Succ√®s !</strong> {{ successMessage }}
        <div class="success-details">
          Nous vous contacterons dans les 24-48 heures.
          <!-- CORRECTION: Utiliser isLoggedIn() au lieu de authService.isLoggedIn() -->
          @if (isLoggedIn()) {
            <div class="redirect-message">
              Redirection vers votre tableau de bord...
            </div>
          }
        </div>
      </div>
    </div>
  }

  <!-- Formulaire -->
  @if (!showSuccess) {
    <form class="devis-form" (ngSubmit)="submitDevis()" #devisForm="ngForm">
      
      <!-- Section 1: Informations personnelles -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üë§</div>
          <h2>Informations personnelles</h2>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="clientName">
              Nom complet <span class="required">*</span>
            </label>
            <input type="text" id="clientName" 
                   [(ngModel)]="devisData.clientName" 
                   name="clientName" 
                   required
                   placeholder="Votre nom et pr√©nom">
            <div class="form-hint">Nous avons besoin de votre nom pour vous contacter</div>
          </div>

          <div class="form-group">
            <label for="clientEmail">
              Adresse email <span class="required">*</span>
            </label>
            <input type="email" id="clientEmail" 
                   [(ngModel)]="devisData.clientEmail" 
                   name="clientEmail" 
                   required
                   placeholder="exemple@email.com">
            <div class="form-hint">Nous vous enverrons le devis √† cette adresse</div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="clientPhone">Num√©ro de t√©l√©phone</label>
            <input type="tel" id="clientPhone" 
                   [(ngModel)]="devisData.clientPhone" 
                   name="clientPhone"
                   placeholder="71 234 567">
            <div class="form-hint">Pour vous contacter plus rapidement</div>
          </div>

          <div class="form-group">
            <label for="projectAddress">Adresse du projet</label>
            <input type="text" id="projectAddress" 
                   [(ngModel)]="devisData.projectAddress" 
                   name="projectAddress" 
                   placeholder="Ex: Rue Habib Bourguiba, Tunis">
            <div class="form-hint">O√π se situe votre projet ?</div>
          </div>
        </div>
      </div>

      <!-- Section 2: D√©tails du projet -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üèóÔ∏è</div>
          <h2>D√©tails du projet</h2>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="projectType">
              Type de projet <span class="required">*</span>
            </label>
            <select id="projectType" 
                    [(ngModel)]="devisData.projectType" 
                    name="projectType" required>
              <option value="construction">Construction neuve</option>
              <option value="renovation">R√©novation / R√©habilitation</option>
              <option value="interior">Am√©nagement int√©rieur</option>
              <option value="extension">Extension / Agrandissement</option>
              <option value="other">Autre type de travaux</option>
            </select>
          </div>

          <div class="form-group">
            <label for="surface">Surface (m¬≤)</label>
            <div class="input-with-unit">
              <input type="number" id="surface" 
                     [(ngModel)]="devisData.surface" 
                     name="surface" 
                     min="0" 
                     step="0.1"
                     placeholder="0">
              <span class="input-unit">m¬≤</span>
            </div>
            <div class="form-hint">Superficie totale √† construire/r√©nover</div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="budget">Budget estim√©</label>
            <div class="input-with-unit">
              <input type="text" id="budget" 
                     [(ngModel)]="devisData.budget" 
                     name="budget"
                     placeholder="50,000">
              <span class="input-unit">DT</span>
            </div>
            <div class="form-hint">Budget approximatif que vous envisagez</div>
          </div>

          <div class="form-group">
            <label for="deadline">Date souhait√©e de d√©but</label>
            <input type="date" id="deadline" 
                   [(ngModel)]="devisData.deadline" 
                   name="deadline"
                   [min]="getMinDate()">
            <div class="form-hint">Date √† laquelle vous souhaitez commencer</div>
          </div>
        </div>

        <div class="form-group">
          <label for="style">Style architectural souhait√©</label>
          <input type="text" id="style" 
                 [(ngModel)]="devisData.style" 
                 name="style" 
                 placeholder="Ex: Moderne, Traditionnel, Contemporain, Minimaliste...">
          <div class="form-hint">D√©crivez le style que vous pr√©f√©rez</div>
        </div>
      </div>

      <!-- Section 3: Travaux demand√©s -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üîß</div>
          <h2>Travaux demand√©s</h2>
        </div>
        
        <p class="section-description">S√©lectionnez les types de travaux dont vous avez besoin :</p>
        
        <div class="tasks-grid">
          @for (task of availableTasks; track task) {
            <div class="task-item" 
                 [class.selected]="isTaskSelected(task)"
                 (click)="toggleTask(task)">
              <span class="task-icon">{{ isTaskSelected(task) ? '‚úì' : '+' }}</span>
              <span class="task-text">{{ task }}</span>
            </div>
          }
        </div>

        <div class="form-group">
          <label for="additionalTasks">Autres travaux ou pr√©cisions</label>
          <textarea id="additionalTasks" 
                    [(ngModel)]="devisData.additionalTasks" 
                    name="additionalTasks" 
                    rows="4"
                    placeholder="D√©crivez d'autres travaux sp√©cifiques, des exigences particuli√®res, ou toute pr√©cision suppl√©mentaire..."></textarea>
          <div class="form-hint">Plus vous serez pr√©cis, plus notre devis sera exact</div>
        </div>
      </div>

      <!-- Section 4: Description d√©taill√©e -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üìù</div>
          <h2>Description d√©taill√©e du projet</h2>
        </div>
        
        <div class="form-group">
          <label for="description">
            Description <span class="required">*</span>
          </label>
          <textarea id="description" 
                    [(ngModel)]="devisData.description" 
                    name="description" 
                    rows="6" 
                    required
                    placeholder="D√©crivez votre projet en d√©tail :
‚Ä¢ Quels sont vos besoins ?
‚Ä¢ Y a-t-il des contraintes particuli√®res ?
‚Ä¢ Avez-vous des plans ou croquis ?
‚Ä¢ Quelle est la disposition souhait√©e ?
‚Ä¢ Autres informations importantes..."></textarea>
          <div class="form-hint">Une description d√©taill√©e nous aide √† comprendre exactement ce dont vous avez besoin</div>
        </div>
      </div>

      <!-- Section 5: Actions -->
      <div class="form-actions">
        <div class="actions-info">
          <p class="required-info"><span class="required">*</span> Champs obligatoires</p>
          <p class="privacy-info">üîí Vos informations sont confidentielles et s√©curis√©es</p>
        </div>
        
        <div class="action-buttons">
          <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="isLoading">
            <span class="btn-icon">‚Üê</span>
            <span class="btn-text">Annuler</span>
          </button>
          
          <button type="submit" class="btn btn-primary" [disabled]="isLoading">
            @if (isLoading) {
              <span class="btn-icon">‚è≥</span>
              <span class="btn-text">Envoi en cours...</span>
            } @else {
              <span class="btn-icon">üì§</span>
              <span class="btn-text">Envoyer la demande de devis</span>
            }
          </button>
        </div>
      </div>
    </form>
  }
</div>